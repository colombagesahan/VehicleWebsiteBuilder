<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BizNet | Global Ecosystem</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- OVERLAYS -->
    <div id="loader" class="overlay flex-center"><div class="spinner"></div><p class="mt-2 blink">Initializing BizNet Secure...</p></div>
    <div id="toastBox"></div>

    <!-- AUTHENTICATION -->
    <section id="viewAuth" class="view active flex-center">
        <div class="auth-card">
            <h1 class="logo">Biz<span>Net</span></h1>
            <p class="text-muted">The Economic Super-Network</p>
            <div class="tabs-pill mt-4">
                <button class="pill active" onclick="authUI.switch('login')">Login</button>
                <button class="pill" onclick="authUI.switch('register')">Register</button>
            </div>
            <form id="authForm" onsubmit="authUI.submit(event)">
                <input type="email" id="email" placeholder="Email Address" required>
                <input type="password" id="password" placeholder="Password" required>
                <div id="regFields" class="hidden fade-in">
                    <input type="text" id="fullName" placeholder="Full Legal Name">
                    <input type="tel" id="phone" placeholder="Mobile Number (e.g. +94...)">
                </div>
                <button type="submit" class="btn btn-primary full-width mt-4">Access Dashboard &rarr;</button>
            </form>
        </div>
    </section>

    <!-- APP DASHBOARD -->
    <section id="viewApp" class="view hidden">
        <div class="app-grid">
            
            <!-- 1. LEFT RAIL (Context Switcher) -->
            <nav class="rail">
                <div class="rail-icon active" id="railPersonal" onclick="app.setContext('personal')" title="Personal Profile">
                    <i class="fa-solid fa-user"></i>
                </div>
                <div class="rail-divider"></div>
                <div id="railBizList"></div>
                <div class="rail-icon add" onclick="biz.openCreateModal()" title="Start Business">
                    <i class="fa-solid fa-plus"></i>
                </div>
                <div class="rail-bottom">
                    <div class="rail-icon logout" onclick="auth.signOut()"><i class="fa-solid fa-power-off"></i></div>
                </div>
            </nav>

            <!-- 2. SIDEBAR (Navigation) -->
            <aside class="sidebar" id="sidebarMenu"></aside>

            <!-- 3. MAIN CONTENT -->
            <main class="content" id="mainArea">
                
                <!-- === PERSONAL VIEWS === -->
                <div id="v-feed" class="tab-view">
                    <div class="header-card">
                        <div>
                            <h2>Community Feed</h2>
                            <p class="text-sm">Connect with Sellers & Buyers</p>
                        </div>
                        <button class="btn btn-primary btn-sm" onclick="social.openPostModal()">
                            <i class="fa-solid fa-pen"></i> Post
                        </button>
                    </div>
                    <div id="feedStream" class="mt-4"></div>
                </div>

                <div id="v-wallet" class="tab-view hidden">
                    <div class="wallet-banner">
                        <small>Available Balance</small>
                        <h1 id="walletBalance">Rs. 0.00</h1>
                        <div class="wallet-actions">
                            <button onclick="finance.withdrawModal()">Withdraw</button>
                            <button onclick="ui.goto('v-earn')">Earn Money</button>
                        </div>
                    </div>
                    <h3 class="mt-4">History</h3>
                    <div id="txnHistory" class="list-group"></div>
                </div>

                <div id="v-earn" class="tab-view hidden">
                    <div class="header-card">
                        <h2>Paid Messages</h2>
                        <p class="text-sm">Earn Rs. 2.00 per view</p>
                    </div>
                    <div id="adGrid" class="grid-col-3 mt-4"></div>
                </div>

                <div id="v-partners" class="tab-view hidden">
                    <h2>Partner Opportunities</h2>
                    <p class="text-sm mb-4">Resell products and earn commissions.</p>
                    <div id="partnerGrid" class="grid-col-2"></div>
                </div>

                <!-- === BUSINESS VIEWS === -->
                <div id="v-biz-dash" class="tab-view hidden">
                    <div class="header-card">
                        <h2 id="bizTitle">...</h2>
                        <span class="badge" id="bizType">...</span>
                    </div>
                    <div class="stats-row mt-4">
                        <div class="stat-box"><span>Wallet</span><strong id="bizWallet">Rs. 0</strong></div>
                        <div class="stat-box"><span>Views</span><strong>0</strong></div>
                    </div>
                    <!-- Send Ad -->
                    <div class="card mt-4 border-gold">
                        <h3><i class="fa-solid fa-bolt text-gold"></i> Message Blast</h3>
                        <p class="text-sm text-muted">Cost: Rs. 5.00 / user</p>
                        <form onsubmit="finance.launchCampaign(event)">
                            <textarea id="campMsg" class="full-width mt-2" placeholder="Promote your product..." required></textarea>
                            <div class="grid-col-2 mt-2">
                                <input type="url" id="campLink" placeholder="Link" required>
                                <input type="number" id="campCount" placeholder="Target Users" required>
                            </div>
                            <button class="btn btn-gold full-width mt-2">Send Blast</button>
                        </form>
                    </div>
                </div>

                <div id="v-biz-products" class="tab-view hidden">
                    <div class="flex-between">
                        <h2>Inventory</h2>
                        <button class="btn btn-primary btn-sm" onclick="biz.addProductModal()">+ Add</button>
                    </div>
                    <div id="bizProdList" class="grid-col-3 mt-4"></div>
                </div>

                <div id="v-biz-funds" class="tab-view hidden">
                    <h2>Ad Credits</h2>
                    <div class="card bg-dark text-white mt-2">
                        <p class="text-muted">Deposit via Bank Transfer</p>
                        <h3>Commercial Bank (Homagama)</h3>
                        <h1 class="text-gold">8750053306</h1>
                        <p>COLOMBAGE SD</p>
                    </div>
                    <form class="card mt-4" onsubmit="finance.deposit(event)">
                        <label>Upload Receipt</label>
                        <input type="file" id="depSlip" required class="mb-2">
                        <input type="number" id="depAmount" placeholder="Amount (Rs)" required>
                        <button class="btn btn-success full-width mt-2">Submit Verification</button>
                    </form>
                </div>

                <div id="v-biz-settings" class="tab-view hidden">
                    <h2>Partner Program</h2>
                    <div class="card mt-2">
                        <label class="flex-center" style="justify-content:flex-start; gap:10px;">
                            <input type="checkbox" id="bizPartnerActive" onchange="biz.saveSettings()"> 
                            Active Partner Program
                        </label>
                        <input type="text" id="bizCommission" placeholder="Commission (e.g. Rs. 500 per sale)" class="mt-2" onchange="biz.saveSettings()">
                        <p class="text-sm text-muted mt-2">Users will see this in the Partner tab.</p>
                    </div>
                    <div class="card mt-4">
                        <h3>Generated Website</h3>
                        <p class="text-sm text-muted">Your visual page is live.</p>
                        <a id="bizSiteLink" href="#" target="_blank" class="btn btn-outline full-width mt-2">Open Website</a>
                    </div>
                </div>

            </main>
        </div>
    </section>

    <!-- GENERIC MODAL -->
    <div id="modal" class="modal-bg hidden">
        <div class="modal-box">
            <button class="close-btn" onclick="ui.closeModal()">&times;</button>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- FIREBASE SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="script.js"></script>
</body>
</html>
