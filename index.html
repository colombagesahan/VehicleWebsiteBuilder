<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VehicleBuilder Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- LOADERS -->
    <div id="initLoader" class="init-loader"><div class="spinner"></div><p>Loading System...</p></div>
    <div id="loader" class="loader-overlay hidden"><div class="spinner"></div><p id="loaderText">Processing...</p></div>
    <div id="toastContainer" class="toast-container"></div>

    <!-- MODALS -->
    <div id="modalOverlay" class="modal-overlay hidden"><div class="modal-content"><button class="close-modal" onclick="ui.closeModal()">&times;</button><div id="modalBody"></div></div></div>
    
    <!-- Edit Modal (Shared) -->
    <div id="editDataModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="close-modal" onclick="document.getElementById('editDataModal').classList.add('hidden')">&times;</button>
            <h2>Edit Item</h2>
            <form id="formEditData">
                <input type="hidden" id="editId">
                <input type="hidden" id="editCollection">
                <div class="form-group"><label>Title/Name</label><input type="text" id="editTitle" required></div>
                <div class="form-group"><label>Price (Rs)</label><input type="number" id="editPrice" required></div>
                <div class="form-group"><label>Description</label><textarea id="editDesc" rows="4"></textarea></div>
                <button type="submit" class="btn btn-primary full-width">Update</button>
            </form>
        </div>
    </div>

    <!-- Admin & FB Modals -->
    <div id="adModal" class="modal-overlay hidden"><div class="modal-content ad-content"><button class="close-modal" onclick="document.getElementById('adModal').classList.add('hidden')">&times;</button><div id="adContentArea"></div></div></div>
    <div id="fbModal" class="modal-overlay hidden"><div class="modal-content fb-content text-center"><button class="close-modal" onclick="document.getElementById('fbModal').classList.add('hidden')">&times;</button><i class="fa-brands fa-facebook text-primary" style="font-size:3rem;"></i><h3>Like us on Facebook!</h3><div id="fbLinkArea" class="mt-4"></div></div></div>

    <!-- =======================================================
         PLATFORM DASHBOARD
    ======================================================== -->
    <div id="platformApp">
        <nav class="navbar">
            <div class="nav-brand">Vehicle<span>Builder</span></div>
            <div class="nav-links">
                <button id="btnLoginNav" class="btn btn-primary btn-sm">Login</button>
                <button id="btnLogoutNav" class="btn btn-outline btn-sm hidden">Logout</button>
            </div>
        </nav>

        <!-- LANDING (Dynamic based on role logic) -->
        <section id="viewLanding" class="view">
            <div class="hero">
                <h1 id="landingTitle">Join the Platform</h1>
                <p>Create your account to get started.</p>
                <button class="btn btn-primary btn-lg" onclick="ui.showView('viewAuth')">Sign In / Sign Up</button>
                <div style="margin-top:20px;">
                    <a href="home.html" style="color: #2563eb; text-decoration:underline;">&larr; Back to Role Selection</a>
                </div>
            </div>
        </section>

        <!-- AUTH -->
        <section id="viewAuth" class="view hidden">
            <div class="auth-container">
                <h2 id="authTitle">Login</h2>
                <form id="authForm">
                    <input type="email" id="authEmail" placeholder="Email Address" required>
                    <input type="password" id="authPass" placeholder="Password" required>
                    <div class="btn-group">
                        <button type="button" id="btnLogin" class="btn btn-primary">Login</button>
                        <button type="button" id="btnSignup" class="btn btn-secondary">Create Account</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- DASHBOARD (Dynamic Sidebar) -->
        <section id="viewDashboard" class="view hidden">
            <div class="dash-layout">
                <aside class="dash-sidebar">
                    <div class="user-info">
                        <div class="avatar-circle" id="dashAvatar"><i class="fa-solid fa-user"></i></div>
                        <span id="dashEmail">User</span>
                        <span id="dashRole" class="badge">Role</span>
                    </div>
                    <nav class="side-nav" id="dynamicSidebar">
                        <!-- JS WILL INJECT BUTTONS HERE -->
                    </nav>
                </aside>

                <main class="dash-content">
                    
                    <!-- 1. COMMON PROFILE -->
                    <div id="tabProfile" class="dash-tab active">
                        <h2>User Profile</h2>
                        <div class="card">
                            <div class="form-group"><label>Profile Photo</label><input type="file" id="profPhoto" accept="image/*"></div>
                            <div class="form-group"><label>Phone</label><input type="tel" id="profPhone" required></div>
                            <div class="form-group"><label>WhatsApp</label><input type="tel" id="profWhatsapp" required></div>
                            <div class="form-group"><label>Address</label><textarea id="profAddress" required></textarea></div>
                            <button id="saveProfile" class="btn btn-primary">Save Profile</button>
                        </div>
                    </div>

                    <!-- 2. VEHICLE SELLER TABS (Existing) -->
                    <div id="tabAddVehicle" class="dash-tab">
                        <h2>Add Vehicle</h2>
                        <form id="formAddVehicle" class="card">
                            <div class="grid-2">
                                <select id="vCat"></select>
                                <input type="text" id="vBrand" placeholder="Brand" required>
                                <input type="text" id="vModel" placeholder="Model" required>
                                <input type="text" id="vTrim" placeholder="Trim">
                                <input type="number" id="vYear" placeholder="Year" required>
                                <input type="text" id="vCond" placeholder="Condition">
                                <select id="vTrans"><option>Automatic</option><option>Manual</option></select>
                                <select id="vFuel"><option>Petrol</option><option>Diesel</option><option>Hybrid</option><option>Electric</option></select>
                                <input type="number" id="vPrice" placeholder="Price" required>
                                <input type="number" id="vMileage" placeholder="Mileage" required>
                            </div>
                            <textarea id="vDesc" placeholder="Description"></textarea>
                            <input type="url" id="vYoutube" placeholder="YouTube Link">
                            <input type="file" id="vPhotos" multiple>
                            <button type="submit" class="btn btn-primary full-width">Publish Vehicle</button>
                        </form>
                    </div>

                    <div id="tabMyVehicles" class="dash-tab">
                        <h2>My Inventory</h2>
                        <input type="text" id="searchV" placeholder="Search..." class="full-width mb-2">
                        <div id="myVehiclesList" class="vehicle-grid"></div>
                    </div>

                    <!-- 3. PARTS SELLER TABS (New) -->
                    <div id="tabAddPart" class="dash-tab">
                        <h2>Add Auto Part</h2>
                        <form id="formAddPart" class="card">
                            <div class="grid-2">
                                <input type="text" id="pName" placeholder="Part Name (e.g. Brake Pads)" required>
                                <input type="text" id="pBrand" placeholder="Brand/Make">
                                <input type="text" id="pModel" placeholder="Fits Model (e.g. Toyota Allion)">
                                <input type="number" id="pPrice" placeholder="Price (Rs)" required>
                                <select id="pCondition"><option>Brand New</option><option>Reconditioned</option><option>Used</option></select>
                            </div>
                            <textarea id="pDesc" placeholder="Description"></textarea>
                            <input type="file" id="pPhotos" multiple>
                            <button type="submit" class="btn btn-primary full-width">Publish Part</button>
                        </form>
                    </div>

                    <div id="tabMyParts" class="dash-tab">
                        <h2>My Products</h2>
                        <div id="myPartsList" class="vehicle-grid"></div>
                    </div>

                    <!-- 4. SERVICE / FINANCE TABS (New) -->
                    <div id="tabAddService" class="dash-tab">
                        <h2>Add Service / Package</h2>
                        <form id="formAddService" class="card">
                            <div class="grid-2">
                                <input type="text" id="sName" placeholder="Service Name (e.g. Full Service / Gold Insurance)" required>
                                <input type="number" id="sPrice" placeholder="Starting Price (Rs)">
                            </div>
                            <textarea id="sDesc" placeholder="Details of the service/package"></textarea>
                            <input type="file" id="sPhotos" multiple>
                            <button type="submit" class="btn btn-primary full-width">Publish Service</button>
                        </form>
                    </div>

                    <div id="tabMyServices" class="dash-tab">
                        <h2>My Services</h2>
                        <div id="myServicesList" class="vehicle-grid"></div>
                    </div>

                    <!-- 5. COMMON WEBSITE BUILDER -->
                    <div id="tabWebsite" class="dash-tab">
                        <h2>Website Builder</h2>
                        <div id="websiteLockScreen" class="lock-overlay">
                            <h3>Setup Your Business Name</h3>
                            <input type="text" id="initSaleName" placeholder="Business Name">
                            <button id="btnUnlockWebsite" class="btn btn-primary">Create Website</button>
                        </div>
                        <div id="websiteEditor" class="hidden">
                            <p>URL: <a href="#" id="mySiteLink" target="_blank">View Site</a></p>
                            <div class="card">
                                <input type="text" id="webName" placeholder="Business Name">
                                <input type="file" id="webLogo">
                                <input type="file" id="webFavicon">
                                <input type="text" id="webHeroTitle" placeholder="Hero Title">
                                <input type="text" id="webHeroSub" placeholder="Hero Subtitle">
                                <textarea id="webAbout" placeholder="About Us"></textarea>
                                <textarea id="webWhy" placeholder="Why Choose Us"></textarea>
                                <input type="text" id="webFb" placeholder="Facebook Link">
                                <input type="file" id="webGallery" multiple>
                                <button id="saveWebsite" class="btn btn-success mt-4">Publish Website</button>
                            </div>
                        </div>
                    </div>

                    <!-- 6. BUYER BROWSE TABS (New) -->
                    <div id="tabBuyerBrowse" class="dash-tab">
                        <h2>Browse Marketplace</h2>
                        <div class="tabs-header">
                            <button class="chip active" onclick="app.buyerFilter('vehicles')">Vehicles</button>
                            <button class="chip" onclick="app.buyerFilter('parts')">Parts</button>
                            <button class="chip" onclick="app.buyerFilter('services')">Services</button>
                            <button class="chip" onclick="app.buyerFilter('finance')">Finance</button>
                        </div>
                        <input type="text" id="buyerSearch" placeholder="Search..." class="full-width mt-4 mb-2">
                        <div id="buyerGrid" class="vehicle-grid"></div>
                    </div>

                    <!-- 7. CONNECT & ADMIN -->
                    <div id="tabConnect" class="dash-tab">
                        <h2>Directory</h2>
                        <div id="sellersGrid" class="sellers-grid"></div>
                    </div>
                    <div id="tabAdmin" class="dash-tab">
                        <h2>Admin</h2>
                        <input type="file" id="adminAdImg">
                        <button id="btnUploadAd" class="btn btn-primary">Upload Ad</button>
                    </div>

                </main>
            </div>
        </section>
    </div>

    <!-- =======================================================
         PART 3: GENERATED WEBSITE (Shared for all Sellers)
    ======================================================== -->
    <div id="generatedSite" class="hidden">
        <header id="genHeader"></header>
        <section id="genHero" class="gen-hero">
            <div class="hero-overlay"></div>
            <div class="hero-content scroll-anim">
                <h1 id="genHeroTitle"></h1>
                <p id="genHeroSub"></p>
                <a href="#genItems" class="hero-btn">View Offerings</a>
            </div>
        </section>
        <section id="genItems" class="gen-section">
            <h2 class="sec-title scroll-anim">Our Offerings</h2>
            <div id="genGrid" class="vehicle-grid scroll-anim"></div>
        </section>
        <section id="genAbout" class="gen-section bg-light">
            <div class="container-split">
                <div class="text-block scroll-anim"><h2 class="sec-title-left">About Us</h2><div id="genAboutContent"></div></div>
                <div class="image-block scroll-anim"><img id="genAboutImg" src="https://via.placeholder.com/800"></div>
            </div>
        </section>
        <section id="genWhy" class="gen-section bg-dark text-white">
            <h2 class="sec-title text-white scroll-anim">Why Choose Us</h2>
            <div id="genWhyGrid" class="features-grid scroll-anim"></div>
        </section>
        <section id="genGallery" class="gen-section">
            <h2 class="sec-title scroll-anim">Gallery</h2>
            <div id="genGalleryTrack" class="gallery-scroller scroll-anim"></div>
        </section>
        <section id="genContact" class="gen-section footer-section">
            <h2 class="sec-title text-white scroll-anim">Contact Us</h2>
            <div class="contact-layout scroll-anim">
                <div id="genContactInfo" class="contact-details"></div>
                <div id="genMap" class="map-box">
                    <iframe width="100%" height="100%" frameborder="0" style="border:0" src="https://maps.google.com/maps?q=Sri%20Lanka&t=&z=13&ie=UTF8&iwloc=&output=embed" allowfullscreen></iframe>
                </div>
            </div>
            <div id="genFooter" class="footer-bottom"></div>
        </section>
        <a href="#" id="floatWhatsapp" class="float-wa hidden" target="_blank"><i class="fa-brands fa-whatsapp"></i></a>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="script.js"></script>
</body>
</html>
