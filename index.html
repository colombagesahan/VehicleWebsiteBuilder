<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VehicleWebsiteBuilder</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- LOADERS -->
    <div id="initLoader" class="init-loader">
        <div class="spinner"></div>
        <p>Loading Platform...</p>
    </div>
    <div id="loader" class="loader-overlay hidden">
        <div class="spinner"></div>
        <p id="loaderText">Processing...</p>
    </div>

    <!-- TOAST -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- 1. EDIT VEHICLE MODAL (New Feature) -->
    <div id="editVehicleModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="close-modal" onclick="document.getElementById('editVehicleModal').classList.add('hidden')">&times;</button>
            <h2>Edit Vehicle</h2>
            <form id="formEditVehicle">
                <input type="hidden" id="editVId"> <!-- Hidden ID storage -->
                <div class="grid-2">
                    <div class="form-group"><label>Brand</label><input type="text" id="editVBrand" required></div>
                    <div class="form-group"><label>Model</label><input type="text" id="editVModel" required></div>
                    <div class="form-group"><label>Price (Rs)</label><input type="number" id="editVPrice" required></div>
                    <div class="form-group"><label>Mileage</label><input type="number" id="editVMileage" required></div>
                </div>
                <div class="form-group"><label>Description</label><textarea id="editVDesc" rows="4"></textarea></div>
                <button type="submit" class="btn btn-primary full-width">Update Vehicle</button>
            </form>
        </div>
    </div>

    <!-- GENERIC MODAL -->
    <div id="modalOverlay" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="close-modal" onclick="ui.closeModal()">&times;</button>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- ADMIN & FB MODALS -->
    <div id="adModal" class="modal-overlay hidden">
        <div class="modal-content ad-content">
            <button class="close-modal" onclick="document.getElementById('adModal').classList.add('hidden')">&times;</button>
            <div id="adContentArea"></div>
        </div>
    </div>
    <div id="fbModal" class="modal-overlay hidden">
        <div class="modal-content fb-content text-center">
            <button class="close-modal" onclick="document.getElementById('fbModal').classList.add('hidden')">&times;</button>
            <i class="fa-brands fa-facebook text-primary" style="font-size: 3rem; margin-bottom:1rem;"></i>
            <h3>Like us on Facebook!</h3>
            <div id="fbLinkArea" class="mt-4"></div>
        </div>
    </div>

    <!-- =======================================================
         PART 1: THE PLATFORM
    ======================================================== -->
    <div id="platformApp">
        <nav class="navbar">
            <div class="nav-brand">Vehicle<span>Builder</span></div>
            <div class="nav-links">
                <button id="btnLoginNav" class="btn btn-primary btn-sm">Login</button>
                <button id="btnLogoutNav" class="btn btn-outline btn-sm hidden">Logout</button>
            </div>
        </nav>

        <section id="viewLanding" class="view">
            <div class="hero">
                <h1>Create Your Professional Vehicle Sales Website</h1>
                <p>Powerful content, responsive design, and instant setup.</p>
                <button class="btn btn-primary btn-lg" onclick="ui.showView('viewAuth')">Get Started</button>
            </div>
            <div class="features">
                <div class="landing-card"><i class="fa-solid fa-mobile-screen"></i><h3>100% Responsive</h3></div>
                <div class="landing-card"><i class="fa-solid fa-bolt"></i><h3>Fast & Powerful</h3></div>
                <div class="landing-card"><i class="fa-solid fa-images"></i><h3>Auto Image Compress</h3></div>
            </div>
        </section>

        <section id="viewAuth" class="view hidden">
            <div class="auth-container">
                <h2>Welcome Back</h2>
                <form id="authForm">
                    <input type="email" id="authEmail" placeholder="Email Address" required>
                    <input type="password" id="authPass" placeholder="Password" required>
                    <div class="btn-group">
                        <button type="button" id="btnLogin" class="btn btn-primary">Login</button>
                        <button type="button" id="btnSignup" class="btn btn-secondary">Create Account</button>
                    </div>
                </form>
            </div>
        </section>

        <section id="viewDashboard" class="view hidden">
            <div class="dash-layout">
                <aside class="dash-sidebar">
                    <div class="user-info">
                        <div class="avatar-circle" id="dashAvatar"><i class="fa-solid fa-user"></i></div>
                        <span id="dashEmail">User</span>
                    </div>
                    <nav class="side-nav">
                        <button onclick="ui.switchTab('tabProfile')" class="nav-item active"><i class="fa-solid fa-id-card"></i> Profile</button>
                        <button onclick="ui.switchTab('tabAddVehicle')" class="nav-item"><i class="fa-solid fa-plus"></i> Add Vehicle</button>
                        <button onclick="ui.switchTab('tabMyVehicles')" class="nav-item"><i class="fa-solid fa-list"></i> My Vehicles</button>
                        <button onclick="ui.switchTab('tabWebsite')" class="nav-item"><i class="fa-solid fa-globe"></i> My Website</button>
                        <button onclick="ui.switchTab('tabConnect')" class="nav-item"><i class="fa-solid fa-users"></i> Connect</button>
                        <button onclick="ui.switchTab('tabAdmin')" id="navAdmin" class="nav-item hidden"><i class="fa-solid fa-lock"></i> Admin</button>
                    </nav>
                </aside>

                <main class="dash-content">
                    
                    <!-- 1. PROFILE SECTION (Updated Text) -->
                    <div id="tabProfile" class="dash-tab active">
                        <h2>User Profile</h2>
                        <div class="card">
                            <div class="alert-box">
                                <i class="fa-solid fa-triangle-exclamation"></i>
                                <div>
                                    <strong>Important:</strong> These details are <strong>REQUIRED</strong>. They will appear on your generated website's "Contact Us" section. Customers use this to call/message you.
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Profile Photo (Required)</label>
                                <input type="file" id="profPhoto" accept="image/*">
                            </div>
                            <div class="form-group">
                                <label>Phone Number (Required)</label>
                                <input type="tel" id="profPhone" placeholder="+94 77 123 4567" required>
                            </div>
                            <div class="form-group">
                                <label>WhatsApp Number (Required)</label>
                                <input type="tel" id="profWhatsapp" placeholder="94771234567 (No symbols)" required>
                            </div>
                            <div class="form-group">
                                <label>Address (Required)</label>
                                <textarea id="profAddress" placeholder="Your Car Sale Address" required></textarea>
                            </div>
                            <button id="saveProfile" class="btn btn-primary">Save Profile Details</button>
                        </div>
                    </div>

                    <!-- 2. ADD VEHICLE (Fixed 10 photos) -->
                    <div id="tabAddVehicle" class="dash-tab">
                        <h2>Add New Vehicle</h2>
                        <form id="formAddVehicle" class="card">
                            <div class="grid-2">
                                <div class="form-group">
                                    <label>Category (Required)</label>
                                    <select id="vCat" required></select>
                                </div>
                                <div class="form-group"><label>Brand</label><input type="text" id="vBrand" required></div>
                                <div class="form-group"><label>Model</label><input type="text" id="vModel" required></div>
                                <div class="form-group"><label>Trim</label><input type="text" id="vTrim"></div>
                                <div class="form-group"><label>Year</label><input type="number" id="vYear" required></div>
                                <div class="form-group"><label>Condition</label><input type="text" id="vCond"></div>
                                <div class="form-group">
                                    <label>Transmission</label>
                                    <select id="vTrans" required><option>Automatic</option><option>Manual</option><option>Tiptronic</option></select>
                                </div>
                                <div class="form-group">
                                    <label>Fuel Type</label>
                                    <select id="vFuel" required><option>Petrol</option><option>Diesel</option><option>Hybrid</option><option>Electric</option></select>
                                </div>
                                <div class="form-group"><label>Price (Rs)</label><input type="number" id="vPrice" required></div>
                                <div class="form-group"><label>Mileage (km)</label><input type="number" id="vMileage" required></div>
                                <div class="form-group"><label>Body Type</label><input type="text" id="vBody"></div>
                                <div class="form-group"><label>Engine Capacity</label><input type="text" id="vEngine"></div>
                                <div class="form-group">
                                    <label>Book</label>
                                    <select id="vBook"><option>Original</option><option>Duplicate</option></select>
                                </div>
                                <div class="form-group">
                                    <label>Finance</label>
                                    <select id="vFinance"><option value="no">No active finance</option><option value="yes">Active finance agreement</option></select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Description (Max 500 words)</label>
                                <textarea id="vDesc" maxlength="2500"></textarea>
                            </div>
                            <div class="form-group">
                                <label>YouTube Link</label>
                                <input type="url" id="vYoutube">
                            </div>
                            <!-- FIXED: Multiple is essential -->
                            <div class="form-group">
                                <label>Photos (Max 10)</label>
                                <input type="file" id="vPhotos" multiple accept="image/*">
                                <div id="vPreview" class="img-preview-grid"></div>
                            </div>
                            <button type="submit" class="btn btn-primary full-width">Publish Vehicle</button>
                        </form>
                    </div>

                    <!-- 3. MY VEHICLES (Fixed Search & Buttons) -->
                    <div id="tabMyVehicles" class="dash-tab">
                        <h2>My Inventory</h2>
                        <div class="filter-bar">
                            <input type="text" id="searchV" placeholder="Search by brand or model...">
                            <select id="sortV">
                                <option value="new">Newest First</option>
                                <option value="old">Oldest First</option>
                            </select>
                        </div>
                        <div id="myVehiclesList" class="vehicle-grid"></div>
                    </div>

                    <!-- 4. MY WEBSITE (Preserved) -->
                    <div id="tabWebsite" class="dash-tab">
                        <h2>Website Builder</h2>
                        
                        <div id="websiteLockScreen" class="lock-overlay">
                            <div class="lock-box">
                                <i class="fa-solid fa-store"></i>
                                <h3>Setup Your Sale Name</h3>
                                <p>Enter your Vehicle Sale Name to unlock the website builder.</p>
                                <input type="text" id="initSaleName" placeholder="e.g. City Car Sale">
                                <button id="btnUnlockWebsite" class="btn btn-primary full-width">Create Website</button>
                            </div>
                        </div>

                        <div id="websiteEditor" class="hidden">
                            <div class="info-banner">
                                <i class="fa-solid fa-link"></i>
                                Your URL: <a href="#" id="mySiteLink" target="_blank" class="font-bold">Generating...</a>
                            </div>

                            <div class="card">
                                <h3>Branding</h3>
                                <div class="form-group"><label>Sale Name</label><input type="text" id="webName"></div>
                                <div class="grid-2">
                                    <div class="form-group"><label>Logo</label><input type="file" id="webLogo"></div>
                                    <div class="form-group"><label>Favicon</label><input type="file" id="webFavicon"></div>
                                </div>
                                <div class="form-group">
                                    <label>Navbar Style</label>
                                    <select id="webNavStyle">
                                        <option value="1">Style 1: Center (Logo Top)</option>
                                        <option value="2">Style 2: Left Align</option>
                                    </select>
                                </div>
                                <h3>Content</h3>
                                <div class="form-group"><label>Hero Title</label><input type="text" id="webHeroTitle"></div>
                                <div class="form-group"><label>Hero Subtitle</label><input type="text" id="webHeroSub"></div>
                                <div class="form-group"><label>About Us</label><textarea id="webAbout" rows="5"></textarea></div>
                                <div class="form-group"><label>Why Choose Us</label><textarea id="webWhy" rows="5"></textarea></div>
                                <h3>Media</h3>
                                <div class="form-group"><label>Gallery</label><input type="file" id="webGallery" multiple></div>
                                <div class="form-group"><label>Facebook</label><input type="text" id="webFb"></div>
                                <button id="saveWebsite" class="btn btn-success mt-4">Save & Publish</button>
                            </div>
                        </div>
                    </div>

                    <!-- 5. CONNECT -->
                    <div id="tabConnect" class="dash-tab">
                        <h2>Connect with Sellers</h2>
                        <div id="sellersGrid" class="sellers-grid"></div>
                    </div>

                    <!-- 6. ADMIN -->
                    <div id="tabAdmin" class="dash-tab">
                        <h2>Admin Panel</h2>
                        <div class="card">
                            <h3>Global Ad Manager</h3>
                            <input type="file" id="adminAdImg">
                            <button id="btnUploadAd" class="btn btn-primary">Upload Ad</button>
                        </div>
                    </div>
                </main>
            </div>
        </section>
    </div>

    <!-- =======================================================
         PART 2: GENERATED WEBSITE
    ======================================================== -->
    <div id="generatedSite" class="hidden">
        <header id="genHeader"></header>
        <section id="genHero" class="gen-hero">
            <div class="hero-overlay"></div>
            <div class="hero-content scroll-anim">
                <h1 id="genHeroTitle"></h1>
                <p id="genHeroSub"></p>
                <a href="#genVehicles" class="hero-btn">See Vehicles</a>
            </div>
        </section>
        <section id="genVehicles" class="gen-section">
            <h2 class="sec-title scroll-anim">Our Vehicles</h2>
            <div id="genCatFilter" class="filter-chips scroll-anim"></div>
            <div id="genVehicleGrid" class="vehicle-grid scroll-anim"></div>
        </section>
        <section id="genAbout" class="gen-section bg-light">
            <div class="container-split">
                <div class="text-block scroll-anim"><h2 class="sec-title-left">About Us</h2><div id="genAboutContent"></div></div>
                <div class="image-block scroll-anim"><img src="https://images.unsplash.com/photo-1560179707-f14e90ef3dab?auto=format&fit=crop&w=800&q=80"></div>
            </div>
        </section>
        <section id="genWhy" class="gen-section bg-dark text-white">
            <h2 class="sec-title text-white scroll-anim">Why Choose Us</h2>
            <div id="genWhyGrid" class="features-grid scroll-anim"></div>
        </section>
        <section id="genGallery" class="gen-section">
            <h2 class="sec-title scroll-anim">Gallery</h2>
            <div id="genGalleryTrack" class="gallery-scroller scroll-anim"></div>
        </section>
        <section id="genReviews" class="gen-section bg-light">
            <h2 class="sec-title scroll-anim">Happy Customers</h2>
            <div class="reviews-grid scroll-anim">
                <div class="review-card">⭐⭐⭐⭐⭐<p>"Excellent service!"</p></div>
                <div class="review-card">⭐⭐⭐⭐⭐<p>"Highly recommended."</p></div>
                <div class="review-card">⭐⭐⭐⭐⭐<p>"Best prices."</p></div>
            </div>
        </section>
        <section id="genContact" class="gen-section footer-section">
            <h2 class="sec-title text-white scroll-anim">Contact Us</h2>
            <div class="contact-layout scroll-anim">
                <div id="genContactInfo" class="contact-details"></div>
                <div id="genMap" class="map-box">
                    <iframe width="100%" height="100%" frameborder="0" style="border:0" src="https://maps.google.com/maps?q=Sri%20Lanka&t=&z=13&ie=UTF8&iwloc=&output=embed" allowfullscreen></iframe>
                </div>
            </div>
            <div id="genFooter" class="footer-bottom"></div>
        </section>
        <a href="#" id="floatWhatsapp" class="float-wa hidden" target="_blank"><i class="fa-brands fa-whatsapp"></i></a>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="script.js"></script>
</body>
</html>
