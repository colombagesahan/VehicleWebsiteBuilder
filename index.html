<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VehicleBuilder Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- LOADERS -->
    <div id="initLoader" class="init-loader"><div class="spinner"></div><p>Loading Platform...</p></div>
    <div id="loader" class="loader-overlay hidden"><div class="spinner"></div><p id="loaderText">Processing...</p></div>
    <div id="toastContainer" class="toast-container"></div>

    <!-- MODALS -->
    <div id="editVehicleModal" class="modal-overlay hidden">
        <div class="modal-content large-modal-content">
            <div style="display:flex;justify-content:space-between;margin-bottom:15px;">
                <h2>Edit Vehicle</h2>
                <button class="close-modal" onclick="ui.closeModal()" style="position:static;">&times;</button>
            </div>
            <form id="formEditVehicle">
                <input type="hidden" id="editVId">
                <div class="grid-2">
                    <div class="form-group"><label>Brand</label><input type="text" id="editVBrand" required></div>
                    <div class="form-group"><label>Model</label><input type="text" id="editVModel" required></div>
                    <div class="form-group"><label>Price (Rs)</label><input type="number" id="editVPrice" required></div>
                    <div class="form-group"><label>Mileage</label><input type="number" id="editVMileage" required></div>
                    <div class="form-group"><label>Condition</label><input type="text" id="editVCond"></div>
                    <div class="form-group"><label>YouTube ID</label><input type="text" id="editVYoutube"></div>
                </div>
                <div class="form-group"><label>Description</label><textarea id="editVDesc" rows="4"></textarea></div>
                <button type="submit" class="btn btn-primary full-width">Update</button>
            </form>
        </div>
    </div>

    <!-- SITE MODAL -->
    <div id="siteVehicleModal" class="modal-overlay hidden" style="z-index: 9999;">
        <div class="modal-content large-modal dark-modal-theme">
            <button class="close-modal" onclick="document.getElementById('siteVehicleModal').classList.add('hidden')">&times;</button>
            <div id="siteModalContent"></div>
        </div>
    </div>
    
    <div id="lightboxModal" class="lightbox-overlay hidden">
        <span class="close-lightbox" onclick="document.getElementById('lightboxModal').classList.add('hidden')">&times;</span>
        <img id="lightboxImg" src="">
    </div>

    <!-- =======================================================
         DASHBOARD
    ======================================================== -->
    <div id="platformApp">
        <nav class="navbar">
            <div class="nav-brand">Vehicle<span>Builder</span></div>
            <div class="nav-links">
                <button id="btnLoginNav" class="btn btn-primary btn-sm">Login</button>
                <button id="btnLogoutNav" class="btn btn-outline btn-sm hidden">Logout</button>
            </div>
        </nav>

        <section id="viewLanding" class="view">
            <div class="hero">
                <h1 id="landingTitle">Welcome</h1>
                <p>Login to manage your business.</p>
                <button class="btn btn-primary btn-lg" onclick="ui.showView('viewAuth')">Login / Register</button>
                <br><br><a href="home.html" style="text-decoration:underline;">&larr; Back</a>
            </div>
        </section>

        <section id="viewAuth" class="view hidden">
            <div class="auth-container">
                <h2>Account Access</h2>
                <form id="authForm">
                    <div class="form-group"><label>Email</label><input type="email" id="authEmail" required></div>
                    <div class="form-group"><label>Password</label><input type="password" id="authPass" required></div>
                    <div class="btn-group">
                        <button type="button" id="btnLogin" class="btn btn-primary">Login</button>
                        <button type="button" id="btnSignup" class="btn btn-secondary">Register</button>
                    </div>
                </form>
            </div>
        </section>

        <section id="viewDashboard" class="view hidden">
            <div class="dash-layout">
                <aside class="dash-sidebar">
                    <div class="user-info">
                        <div class="avatar-circle" id="dashAvatar"><i class="fa-solid fa-user"></i></div>
                        <span id="dashEmail">User</span>
                        <span id="dashRole" class="badge">Role</span>
                    </div>
                    <nav class="side-nav" id="dynamicSidebar"></nav>
                </aside>

                <main class="dash-content">
                    
                    <!-- PROFILE -->
                    <div id="tabProfile" class="dash-tab active">
                        <h2>Profile Settings</h2>
                        <div class="card">
                            <div class="alert-box warning" id="profileNotice">
                                <i class="fa-solid fa-lock"></i> 
                                <strong>You must complete your profile to unlock your dashboard.</strong>
                            </div>
                            <fieldset id="profFields">
                                <div class="form-group"><label>Profile Photo</label><input type="file" id="profPhoto" accept="image/*"></div>
                                <div class="grid-2">
                                    <div class="form-group">
                                        <label>Phone (No 0)</label>
                                        <input type="tel" id="profPhone" placeholder="771234567" required>
                                    </div>
                                    <div class="form-group">
                                        <label>WhatsApp (No 0)</label>
                                        <input type="tel" id="profWhatsapp" placeholder="771234567" required>
                                    </div>
                                </div>
                                <div class="grid-2">
                                    <div class="form-group">
                                        <label>City / Town</label>
                                        <input type="text" id="profCity" placeholder="e.g. Athurugiriya" required>
                                    </div>
                                    <div class="form-group"><label>Address</label><input type="text" id="profAddress" required></div>
                                </div>
                            </fieldset>
                            <div class="btn-group">
                                <button id="saveProfile" class="btn btn-primary">Save Profile</button>
                                <button id="editProfileBtn" class="btn btn-outline hidden">Edit</button>
                            </div>
                        </div>
                    </div>

                    <!-- ADD VEHICLE -->
                    <div id="tabAddVehicle" class="dash-tab">
                        <h2>Add Vehicle</h2>
                        <form id="formAddVehicle" class="card">
                            <div class="grid-2">
                                <div class="form-group"><label>Category</label><select id="vCat" required></select></div>
                                <div class="form-group"><label>Brand</label><input type="text" id="vBrand" required></div>
                                <div class="form-group"><label>Model</label><input type="text" id="vModel" required></div>
                                <div class="form-group"><label>Price (Rs)</label><input type="number" id="vPrice" required></div>
                            </div>
                            <div class="grid-2">
                                <div class="form-group"><label>Year</label><input type="number" id="vYear"></div>
                                <div class="form-group"><label>Condition</label><input type="text" id="vCond"></div>
                                <div class="form-group"><label>Trans</label><select id="vTrans"><option>Automatic</option><option>Manual</option></select></div>
                                <div class="form-group"><label>Fuel</label><select id="vFuel"><option>Petrol</option><option>Diesel</option><option>Hybrid</option><option>Electric</option></select></div>
                                <div class="form-group"><label>Mileage</label><input type="number" id="vMileage"></div>
                                <div class="form-group"><label>Engine CC</label><input type="text" id="vEngine"></div>
                            </div>
                            <div class="form-group"><label>Description</label><textarea id="vDesc" rows="4"></textarea></div>
                            <div class="form-group"><label>YouTube Link</label><input type="url" id="vYoutube"></div>
                            <div class="form-group">
                                <label>Photos (Max 10)</label>
                                <input type="file" id="vPhotosInput" multiple accept="image/*">
                                <div id="vPhotoStaging" class="img-staging-grid"></div>
                            </div>
                            <button type="submit" class="btn btn-primary full-width mt-4">Publish Vehicle</button>
                        </form>
                    </div>

                    <!-- MY INVENTORY -->
                    <div id="tabMyVehicles" class="dash-tab">
                        <h2>My Inventory</h2>
                        <!-- Fixed Search -->
                        <div class="form-group">
                            <input type="text" id="searchV" placeholder="Type Brand or Model to search..." class="full-width" onkeyup="app.searchVehicles()">
                        </div>
                        <!-- Dynamic Tip -->
                        <div id="inventoryTip" class="alert-box" style="font-size:0.9rem; margin-bottom:15px; display:none;"></div>
                        <div id="myVehiclesList" class="vehicle-grid"></div>
                    </div>

                    <!-- AUTOMATIC PAGE BUILDER -->
                    <div id="tabWebsite" class="dash-tab">
                        <h2>Page Builder</h2>
                        
                        <!-- Lock Screen -->
                        <div id="websiteLockScreen" class="lock-overlay">
                            <h3>Setup Business Page</h3>
                            <p>We use your Profile City & Business Name to create a unique URL.</p>
                            <input type="text" id="initSaleName" placeholder="Business Name (e.g. Sahan Motors)" class="full-width mt-2 mb-2" style="max-width:300px;">
                            <button id="btnUnlockWebsite" class="btn btn-primary">Create Automatic Page</button>
                        </div>

                        <!-- Unlocked -->
                        <div id="websiteEditor" class="hidden">
                            <div class="info-banner mb-2">
                                <strong>Your Page URL:</strong><br>
                                <a href="#" id="mySiteLink" target="_blank" class="font-bold text-lg">...</a>
                            </div>
                            <div class="card text-center" style="padding: 3rem;">
                                <i class="fa-solid fa-magic text-accent" style="font-size: 3rem; margin-bottom: 20px;"></i>
                                <h3>Your Page is Live!</h3>
                                <p class="text-secondary">Your inventory is automatically synchronized.</p>
                                <hr class="mt-4 mb-4">
                                <p class="text-sm text-secondary">Want to change colors or themes?</p>
                                <a href="pagebuilder.html" class="btn btn-outline btn-sm">Open Advanced Visual Editor</a>
                            </div>
                        </div>
                    </div>

                    <!-- Other Roles Placeholders -->
                    <div id="tabAddPart" class="dash-tab"><h2>Parts</h2><p>Parts form here...</p></div>
                    <div id="tabMyParts" class="dash-tab"><h2>My Parts</h2><div id="myPartsList"></div></div>
                    <div id="tabAddService" class="dash-tab"><h2>Service</h2><p>Service form here...</p></div>
                    <div id="tabMyServices" class="dash-tab"><h2>My Services</h2><div id="myServicesList"></div></div>
                    <div id="tabBuyerBrowse" class="dash-tab"><h2>Browse</h2><div id="buyerGrid"></div></div>
                    <div id="tabDirectory" class="dash-tab"><h2>Directory</h2><div id="sellersGrid"></div></div>
                    <div id="tabConnect" class="dash-tab"><h2>Connect</h2><div id="feedStream"></div></div>
                    <div id="tabPromote" class="dash-tab"><h2>Promote</h2><div id="myAdsList"></div></div>

                </main>
            </div>
        </section>
    </div>

    <!-- GENERATED SITE -->
    <div id="generatedSite" class="hidden dark-theme-site">
        <header class="gen-header">
            <div class="wrap nav">
                <div class="brand">
                    <div class="logo">AM</div>
                    <div><div id="genSiteName" style="font-weight:800"></div><div id="genSiteCity" style="font-size:0.8rem;color:#98a8b9"></div></div>
                </div>
                <nav><ul><li><a href="#vehicles">Inventory</a></li><li><a href="#contact">Contact</a></li></ul></nav>
            </div>
        </header>
        <main class="wrap">
            <section class="hero">
                <div class="hero-card">
                    <h1 id="genHeroTitle"></h1>
                    <p id="genHeroSub"></p>
                </div>
            </section>
            <section id="vehicles" class="vehicles">
                <div id="genGrid" class="vehicles-grid"></div>
            </section>
            <section id="contact" class="contact">
                <h3>Contact</h3>
                <div class="hero-card">
                    <p id="genContactPhone"></p>
                    <p id="genContactAddress"></p>
                </div>
            </section>
            <footer>Â© 2025 VehicleBuilder</footer>
        </main>
        <a id="floatWhatsapp" class="whatsapp-float" target="_blank"><i class="fa-brands fa-whatsapp"></i></a>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="script.js"></script>
</body>
</html>
