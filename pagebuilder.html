<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Editor</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; display: flex; height: 100vh; font-family: 'Inter', sans-serif; }
        .sidebar { width: 300px; background: #fff; border-right: 1px solid #ddd; padding: 20px; display: flex; flex-direction: column; }
        .preview { flex: 1; background: #333; display: flex; justify-content: center; align-items: center; }
        .iframe-wrapper { width: 100%; height: 100%; background: white; border: none; }
        h3 { margin-top: 0; }
        label { display: block; margin-top: 10px; font-size: 0.9rem; font-weight: 600; }
        input, select, textarea { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; }
        button { width: 100%; padding: 10px; margin-top: 20px; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        button:hover { background: #1e40af; }
        .back { text-decoration: none; color: #666; font-size: 0.9rem; display: block; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="sidebar">
        <a href="index.html" class="back">&larr; Back to Dashboard</a>
        <h3>Customize Design</h3>
        
        <label>Theme</label>
        <select id="theme">
            <option value="dark">Midnight Dark</option>
            <option value="light">Clean White</option>
            <option value="red">Sport Red</option>
        </select>
        
        <label>Hero Title</label>
        <input type="text" id="heroTitle">
        
        <label>Subtitle</label>
        <input type="text" id="heroSub">
        
        <label>About Us Text</label>
        <textarea id="about" rows="4"></textarea>
        
        <button onclick="save()">Save Changes</button>
        <p id="status" style="text-align:center; margin-top:10px; font-size:0.8rem; color:green;"></p>
    </div>
    
    <div class="preview">
        <div id="prevContent" style="color:white; text-align:center;">Preview Mode Active (Changes visible on live site)</div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = { apiKey: "AIzaSyBUjzMFao9BS3uXBOW3qYrLVqHaGn8qIk4", authDomain: "onlineshop-30cd1.firebaseapp.com", projectId: "onlineshop-30cd1" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        auth.onAuthStateChanged(async user => {
            if(user) {
                const doc = await db.collection('sites').doc(user.uid).get();
                if(doc.exists) {
                    const d = doc.data();
                    document.getElementById('theme').value = d.theme || 'dark';
                    document.getElementById('heroTitle').value = d.heroTitle || '';
                    document.getElementById('heroSub').value = d.heroSub || '';
                    document.getElementById('about').value = d.about || '';
                }
            } else {
                window.location.href = 'index.html';
            }
        });

        async function save() {
            const user = auth.currentUser;
            if(!user) return;
            const btn = document.querySelector('button');
            btn.innerText = "Saving...";
            await db.collection('sites').doc(user.uid).set({
                theme: document.getElementById('theme').value,
                heroTitle: document.getElementById('heroTitle').value,
                heroSub: document.getElementById('heroSub').value,
                about: document.getElementById('about').value
            }, {merge: true});
            btn.innerText = "Save Changes";
            document.getElementById('status').innerText = "Saved! Check your live link.";
        }
    </script>
</body>
</html>
